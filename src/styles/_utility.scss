@use 'src/styles/constants';
@use 'src/styles/breakpoints';
@use 'sass:map';

$line-heights-map: (
  fallback_qpc_uthmani_hafs: (
    tablet: (
      3: 5.5vh,
      4: 6vh,
      5: 5.68vh,
      6: 8.14vh,
      7: 10.61vh,
      8: 13.07vh,
      9: 15.54vh,
      10: 18vh,
    ),
  ),
);

$scales-map: (
  fallback_qpc_uthmani_hafs: (
    tablet: (
      3: 3vh,
      4: 3.6vh,
      5: 4.4vh,
      6: 5.55vh,
      7: 6.7vh,
      8: 7.85vh,
      9: 9vh,
      10: 10.15vh,
    ),
    mobile: (
      3: 5vw,
      4: 8.9vw,
      5: 11vw,
      6: 12vw,
      7: 13vw,
      8: 14vw,
      9: 15vw,
      10: 16vw,
    ),
  ),
);

$skeleton-height-map: (
  default: (
    desktop: (
      3: 4.65vh,
      4: 4.56vh,
      5: 4.63vh,
      6: 6.79vh,
      7: 9.2vh,
      8: 11.72vh,
      9: 14.21vh,
      10: 16.6vh,
    ),
    mobile: (
      3: 5.4vw,
      4: 8.9vw,
      5: 11vw,
      6: 1rem,
      7: 1rem,
      8: 1rem,
      9: 1rem,
      10: 1rem,
    ),
  ),
);

// for now, we're only doing fixed witdth for tablet & desktop.
// because mobile is relatively more stable compared to desktop
// TODO: implement fixed on mobile as well
$line-width-map: (
  fallback_qpc_uthmani_hafs: (
    tablet: (
      3: 63.8vh,
      4: 65vh,
      5: 66vh,
      6: 1rem,
      7: 1rem,
      8: 1rem,
      9: 1rem,
      10: 1rem,
    ),
    desktop: (
      3: 60vh,
      4: 63vh,
      5: 81vh,
      6: 102.6vh,
      7: 124.3vh,
      8: 146.2vh,
      9: 168vh,
      10: 190vh,
    ),
  ),
);

@function map-deep-get($map, $keys...) {
  @each $key in $keys {
    $map: map.get($map, $key);
  }
  @return $map;
}

@function get-scales($name, $device-type, $map) {
  @return map-deep-get($map, $name, $device-type);
}

// generate line-width based on font type, font-scale, and screen width;
@mixin generate-line-width-scales($name) {
  $mobile-scales: get-scales($name, 'mobile', $line-width-map);
  $tablet-scales: get-scales($name, 'tablet', $line-width-map);
  $desktop-scales: get-scales($name, 'desktop', $line-width-map);

  @for $i from 1 through constants.$maximum-font-step {
    .#{$name}-line-width-#{$i} {
      @if $mobile-scales != null and map.has-key($tablet-scales, $i) {
        --line-width: #{map.get($mobile-scales, $i)};
      }

      @if $tablet-scales != null and map.has-key($tablet-scales, $i) {
        @include breakpoints.tablet {
          --line-width: #{map.get($tablet-scales, $i)};
        }
      }

      @if $desktop-scales != null and map.has-key($desktop-scales, $i) {
        @include breakpoints.desktop {
          --line-width: #{map.get($desktop-scales, $i)};
        }
      }
    }
  }
}

@mixin generate-font-scales($name) {
  $mobile-scales: null;
  $tablet-scales: null;
  $tablet-line-height-scales: null;
  $desktop-skeleton-height-scales: null;
  $mobile-skeleton-height-scales: null;

  // reading view skeletons mapping
  @if map.has-key($skeleton-height-map, $name) {
    $desktop-skeleton-height-scales: get-scales($name, 'desktop', $skeleton-height-map);
    $mobile-skeleton-height-scales: get-scales($name, 'mobile', $skeleton-height-map);
  } @else {
    $desktop-skeleton-height-scales: get-scales('default', 'desktop', $skeleton-height-map);
    $mobile-skeleton-height-scales: get-scales('default', 'mobile', $skeleton-height-map);
  }

  // line heights mapping
  @if map.has-key($line-heights-map, $name) {
    $tablet-line-height-scales: get-scales($name, 'tablet', $line-heights-map);
  } @else {
    $tablet-line-height-scales: get-scales('default', 'tablet', $line-heights-map);
  }

  // font scales mapping
  @if map.has-key($scales-map, $name) {
    $mobile-scales: get-scales($name, 'mobile', $scales-map);
    $tablet-scales: get-scales($name, 'tablet', $scales-map);
  } @else {
    $mobile-scales: get-scales('default', 'mobile', $scales-map);
    $tablet-scales: get-scales('default', 'tablet', $scales-map);
  }

  @for $i from 1 through constants.$maximum-font-step {
    .#{$name}-font-size-#{$i} {
      --skeleton-height: #{map.get($mobile-skeleton-height-scales, $i)};
      --font-size: #{map.get($mobile-scales, $i)};
      --line-height: normal;
      @include breakpoints.tablet {
        --font-size: #{map.get($tablet-scales, $i)};
        --line-height: #{map.get($tablet-line-height-scales, $i)};
        --skeleton-height: #{map.get($desktop-skeleton-height-scales, $i)};
      }
      font-size: var(--font-size);
    }
  }
}
